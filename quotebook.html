<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8">
        <script src="jquery-1.7.2.js"></script>
        <script type="text/javascript" src="jquery.parse.js"></script>
        <link rel="stylesheet/less" href="bootstrap/less/bootstrap.less">
        <script src="less-1.3.0.min.js"></script>
        <script src="bootstrap/js/bootstrap-modal.js"></script>
        <script type="text/javascript">
            console.log("QuoteBook app started");
        </script>

    </head>

    <body>
        <script type="text/javascript">
            $.parse.init({
                app_id : "eL5Zl4jRY6fUD3PcmbC6yObE3gSmdwfxShYmkOPi",
                rest_key : "rbNCJ1Mc10EbtICDHCIQmE6gxkeO4NCDXCLDLP0y"    
            });
            
            /*
            /   server methods 
            */
            function getQuotesFromServer(){
                $.parse.get('Quotes',{},processServerResult);
            }
            
            function processServerResult(req){
                console.log("halt");
                for (i in req.results)
                {
                    addQuoteToList(req.results[i]);
                }
            };    
            
            function submitNewQuoteToServer(){
                var parts = $('.newQuote > .newQuotePart');
                for (part in parts)
                {
                    console.log($(part).stringify());
                }
            }
            
            /*
            /   view methods 
            */
            function addNewQuotePart(){
                if($('.newQuote > tbody > tr').size() > 10){
                    alert("A quote with more that 10 parts to it is a short story!");
                }else{
                $('#newQuotePartModel').clone().removeClass('hide').addClass('newQuotePart').appendTo('.newQuote > tbody');
                }
            }
            
            function removeNewQuotePart(){
                $('.quote > tbody > tr:last-child').remove();
            }
            
            function addQuoteToList(quoteToAdd){
                var currentQuote = $('#quoteModel').clone().removeClass('hide');
                
                $(currentQuote).prop("id",null);
                
                for (var i = quoteToAdd.parts.length - 1; i >= 0; i--) {
                    $(currentQuote).find('blockquote').append("<p>"+quoteToAdd.parts[i].said+"</p>");
                };

                $(currentQuote).appendTo('#quoteList > tbody');
            };

            getQuotesFromServer();
        </script>      
        
        <!-- QuoteList  view -->
        <table class="table table-striped" id="quoteList">
            <tbody>
                <!-- This <tr> element shall be coppied for each quote added to quotelist. Its the 'Model' for a quote -->
                <tr class="hide" id="quoteModel">
                    <td>
                        <blockquote>
                        </blockquote>
                    </td>
                </tr>
            </tbody>
        </table>
        <button class="btn" onClick="addQuoteToList()">add</button>
        
        <!-- hidden modal view -->
        <div class="modal hide fade in" id="addQuote">
          <div class="modal-header">
            <button class="close" data-dismiss="modal">Ã—</button>
            <h3>New Quote</h3>
          </div>
          <div class="modal-body">
            <input id="quoteLocation" class="span6" name="location" type="text" placeholder="Where were you when this happened?">
            <table class="newQuote table-striped">
                <tbody>
                    <!-- This <tr> element shall be coppied when the plus button is hit. Its the 'Model' for a quote part -->
                    <tr class="hide" id="newQuotePartModel">
                        <td><input class="span2" type="text" placeholder="Who">  </input><input class="span4" type="text" placeholder="Said What?"></input></td>
                    </tr>
                    <tr>
                        <td class="newQuotePart"><input class="span2" type="text" placeholder="Who">  </input><input class="span4" type="text" placeholder="Said What?"></input></td>
                    </tr>
                </tbody>
            </table>
            <input id="quoteMeta" class="span6" name="location" type="text" placeholder="anything else that needs added.">
          </div>
          <div class="modal-footer">
            <button href="#" class="btn" onClick="addNewQuotePart()">+</button>
            <button href="#" class="btn" onClick="removeNewQuotePart()">-</button>
            <button href="#" class="btn btn-primary" onClick="submitNewQuoteToServer()">Submit</button>
          </div>
        </div>
        <!-- End of modal view -->
        <button class="btn" onClick="$('#addQuote').modal()">Add Your Quote</button>
        
    </body>
</html>