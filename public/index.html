<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8">
        <meta name = "viewport" content="width=device-width, initial-scale=0.75, user-scalable=no">
        <meta http-equiv="X-UA-Compatible" content="chrome=1">
        
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
        <script src="http://ajax.cdnjs.com/ajax/libs/underscore.js/1.1.6/underscore-min.js"></script>
        
        <script type="text/javascript" src="parse-1.0.20.js"></script>
        <link rel="stylesheet" href="bootstrap/css/bootstrap.css">

        <script src="bootstrap/js/bootstrap.js"></script>
        <script type="text/javascript">
            console.log("QuoteBook app started using : "+navigator.appName);
            
            if(navigator.appName == "Microsoft Internet Explorer"){
                alert("This site does not run on IE.");
                window.location="https://www.google.com/chrome/";
            }
        </script>

    </head>

    <body>

        <script type="text/javascript">
        $(function($){
            Parse.initialize('eL5Zl4jRY6fUD3PcmbC6yObE3gSmdwfxShYmkOPi','jfokH6Oa1Cx1PENgS414NUtUPi5UypVTFfGuWQQp');
            
            _.templateSettings = {
                interpolate : /\{\{(.+?)\}\}/g
            };
            /**
             * Define models
             */
            var Quote = Parse.Object.extend("Dev",{
                defaults:{
                    className:'Quote',
                    loc:'a location',
                    meta:'some data',
                    parts:[{"said":"something","who":"person"},{"said":"something else","who":"another person"}]
                }
            }); //Define Quote as a subclass
                        
            var Quotes = Parse.Collection.extend({
              model: Quote,
              view: null
            });
            
            /**
             * Define Views
             */
            var QuoteView = Parse.View.extend({
                tagName: 'tr',
                initialize: function(model){
                    this.model = model || new Quote();
                },
                lineTemplate: _.template("\
                    {{who}}:{{what}}<br>\
                    "),
                template: _.template("\
                    <div>\
                      <blockquote class='QuoteView'>\
                        {{parts[0].who}}:{{parts[0].said}}\
                        <small>{{meta}}</small>\
                        <small>{{loc}}</small>\
                      </blockquote>\
                    </div>\
                    "),
                render: function(){
                    $('#raw').html( this.template( this.model.toJSON() ) );
                    return this;
                }
            });
            
            var EditableQuoteView = Parse.View.extend({
                tagName: 'tr',
                initialize: function(model){
                    this.model = model || new Quote();
                },
                template: _.template('\
                    <div>\
                      <blockquote class="QuoteView">\
                        <input type="text" placeholder="Who"><input type="text" placeholder="Said What...."><a class="btn btn-small btn-info">+</a><a class="btn btn-small btn-info">-</a><br>\
                        <input type="text" placeholder="Where"><input type="text" placeholder="Other info">\
                      </blockquote>\
                    </div>\
                    '),
                render: function(){
                    $(this.el).append( this.template(null) );
                    return this;
                }
            });
            
            var QuotesListView = Parse.View.extend({
                el: $('#quoteList'),
                initialize: function(){
                   
                },
                template: _.template('<div class="QuoteListView"></div>'),
                render: function(){
                    var quoteList;
                    //this is scoped to current view
                    if(quoteList = this.model){
                        var res = quoteList.each(function(item){
                            var itemView = new QuoteView(item);
                            return itemView.render();
                        });
                    }
                }
            });
            
            /**
             * start doing things
             */
            var quotes = new Quotes(); //define instance of quotes Model
            
            window.app = new QuotesListView(); //instance of Quotes View

            app.el = $('#applicationMainView');
            
            quotes.fetch({
                success: function(collection) {
                    app.model = collection;
                    app.render();
                },
                error: function(collection, error) {
                    console.error('The collection could not be retrieved.');
                }
            });

            var newQuoteView = new EditableQuoteView({el:'#newQuoteView'}).render();

        //end of app
        });
        </script>
        <div id='applicationMainView'>
            <!-- some placeholder elements -->
            <div id='newQuoteView'>
                <a class='btn btn-large btn-info'>Add New Quote</a>
            </div>
            <div></div>
            <div></div>
        </div>
    </body>
</html>