<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8">
        <meta name = "viewport" content="width=device-width, initial-scale=0.75, user-scalable=no">
        <meta http-equiv="X-UA-Compatible" content="chrome=1">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
        <script type="text/javascript" src="http://ajax.cdnjs.com/ajax/libs/underscore.js/1.1.6/underscore-min.js"></script>
        <script type="text/javascript" src="parse-1.0.20.js"></script>
        <link rel="stylesheet/less" href="bootstrap/less/bootstrap.less">
        <script src="less-1.3.0.min.js"></script>
        <script src="bootstrap/js/bootstrap-modal.js"></script>
        <script type="text/javascript">
            console.log("QuoteBook app started using : "+navigator.appName);
            
            if(navigator.appName == "Microsoft Internet Explorer"){
                alert("This site does not run on IE.");
                window.location="https://www.google.com/chrome/";
            }
        </script>

    </head>

    <body>
        <script type="text/javascript">
        $(function($){
            Parse.initialize('eL5Zl4jRY6fUD3PcmbC6yObE3gSmdwfxShYmkOPi','jfokH6Oa1Cx1PENgS414NUtUPi5UypVTFfGuWQQp');
            
            /**
             * Define models
             */
            var Quote = Parse.Object.extend("Dev",{
                defaults:{
                    className:'Quote',
                    loc:'a location',
                    meta:'some data',
                    parts:[{"said":"something","who":"person"},{"said":"something else","who":"another person"}]
                }
            }); //Define Quote as a subclass
                        
            var Quotes = Parse.Collection.extend({
              model: Quote,
              view: null
            });
            
            /**
             * Define Views
             */
             var QuoteView = Parse.View.extend({
                tagName: 'tr',
                initialize: function(model){
                    this.model = model || new Quote();
                },
                render: function(){
                    $(this.el).find('*').remove
                    
                    $(this.el).append(this.make('blockquote',{class:'QuoteView'}));
                    $(this.model.get('parts')).each(function(i,part){
                        $('blockquote').append(part.who+' : '+part.said+'<br>');
                    });
                    $('blockquote').append(this.make('small',{},this.model.get('meta')));
                    $('blockquote').append(this.make('small',{},this.model.get('loc')));
                    return this;
                }
            });
            
            var QuotesListView = Parse.View.extend({
                el: $('#quoteList'),
                initialize: function(){
                   
                },
                render: function(){
                    var quoteList;
                    if(quoteList = this.model){
                        var res = quoteList.each(function(item){
                            var itemView = new QuoteView(item);
                            return itemView.render();
                        });
                    }
                },
                addSubView: function(subView){
                    try{
                        $(this.el).append(subView.render);
                    }catch(err){
                        console.warn('Failed to add subview to element : '+this.el);
                        console.warn(err);
                        console.warn('Maybe object passed is not a view?');
                    }
                }
            });
            
            
            
            /**
             * start doing things
             */
            var quotes = new Quotes(); //define instance of quotes Model
            
            window.app = new QuotesListView(); //instance of Quotes View
            app.el = $('#applicationMainView');
            
            quotes.fetch({
                success: function(collection) {
                    app.model = collection;
                    app.render();
                },
                error: function(collection, error) {
                    console.error('The collection could not be retrieved.');
                }
            });

            
        //end of app
        });
        </script>
        <div id='applicationMainView'>
            <!-- some placeholder elements -->
            <div></div>
            <div></div>
            <div></div>
        </div>
    </body>
</html>